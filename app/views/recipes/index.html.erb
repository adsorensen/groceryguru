<head>
    <%= stylesheet_link_tag "recipe_search_results"%>
    <%= stylesheet_link_tag "carousel" %>
</head>
<h2>Recipes</h2>

<h3>Upload Your Own!</h3>
<br>
<div class="container1">
 <div id="manualentry"><%= link_to(image_tag("cookbook.png", :alt => "cookbook", :size => "170x170", :style => "background-color: white;"), new_recipe_path) %><br><%= link_to 'Manual Entry', new_recipe_path %></div>
 <div id="copypaste"><%= link_to(image_tag("copypaste.png", :alt => "clipboard", :size => "170x170", :style => "background-color: white;"), recipes_text_path) %><br><%= link_to 'Copy/Paste', recipes_text_path %></div>
 <div id="url"><%= link_to(image_tag("url.png", :alt => "http", :size => "170x170", :style => "background-color: white;"), recipes_url_path ) %><br><%= link_to 'URL', recipes_url_path %></div>
</div>
<div class="bg-secondary text-center">
  <div class="container">
      <div class="row">
        <div class="col-md-12">
        <h2 class="section-heading">Trending Meals</h2>
        <p style='color: #384048; font-weight: 200;'>Strike Gold With These St. Patrick's Day Recipes</p>
<div class="carousel slide multi-item-carousel" id="theCarousel">
        <div class="carousel-inner">
          <div class="item active">
            <div class="col-xs-4">
                <% recipe = Recipe.find(752)
                if recipe.picture?
                    pic_url = recipe.picture_url
                else
                    pic_url_length = recipe.picture.to_s.length
                    beginning_index = recipe.picture.to_s.index('http')
                    if (beginning_index.nil?)
                        pic_url = 'fallback/recipe-default.png'
                    else
                        cut_url = recipe.picture.to_s[beginning_index, pic_url_length]
                        pic_url = cut_url.gsub!('%3A', ":/")
                    end
                end %>
                <div class="recipe">
                    <div class="image">
                <a href="/recipes/<%=recipe.id%>"><%= image_tag(pic_url, size:"300x300")%></a>
                <div class="name">
                <a href="/recipes/<%=recipe.id%>" style="color:white; padding-top: 5px; padding-bottom: 5px"><%= recipe.name %></a>
                </div></div>
                <ul class="media">
                    <li><i class="fa fa-clock-o"></i> ><%= recipe.prep_time %> Minutes</li>
                    <li><i class="fa fa-cutlery"></i> <%= recipe.servings %> People</li>
                </ul>
                </div>
            </div>
          </div>
          
          <% @recipes_array = [751, 754, 749, 750]
                @recipes_array.each do |index|
                recipe = Recipe.find(index)
                if recipe.picture?
                    pic_url = recipe.picture_url
                else
                    pic_url_length = recipe.picture.to_s.length
                    beginning_index = recipe.picture.to_s.index('http')
                    if (beginning_index.nil?)
                        pic_url = 'fallback/recipe-default.png'
                    else
                        cut_url = recipe.picture.to_s[beginning_index, pic_url_length]
                        pic_url = cut_url.gsub!('%3A', ":/")
                    end
                end%>
    
                <div class="item">
                    <div class="col-xs-4">
                    <div class="recipe">
                    <div class="image">
                <a href="/recipes/<%=recipe.id%>"><%= image_tag(pic_url, size:"300x300")%></a>
                <div class="name">
                <a href="/recipes/<%=recipe.id%>" style="color:white;"><%= recipe.name %></a>
                </div></div>
                <ul class="media">
                    <li><i class="fa fa-clock-o"></i> ><%= recipe.prep_time %> Minutes</li>
                    <li><i class="fa fa-cutlery"></i> <%= recipe.servings %> People</li>
  		        </ul>
                </div>
                    </div>
                </div>
            <% end %>
            <script>
                // Instantiate the Bootstrap carousel
                $('.multi-item-carousel').carousel({
                  interval: false
                });
                
                // for every slide in carousel, copy the next slide's item in the slide.
                // Do the same for the next, next item.
                $('.multi-item-carousel .item').each(function(){
                  var next = $(this).next();
                  if (!next.length) {
                    next = $(this).siblings(':first');
                  }
                  next.children(':first-child').clone().appendTo($(this));
                  
                  if (next.next().length>0) {
                    next.next().children(':first-child').clone().appendTo($(this));
                  } else {
                  	$(this).siblings(':first').children(':first-child').clone().appendTo($(this));
                  }
                });
            </script>
          <!--  Example item end -->
        </div>
        <a class="left carousel-control" href="#theCarousel" data-slide="prev"><i class="glyphicon glyphicon-chevron-left" style="color:white;"></i></a>
        <a class="right carousel-control" href="#theCarousel" data-slide="next"><i class="glyphicon glyphicon-chevron-right" style="color:white;"></i></a>
      </div>
    </div>
    </div>
  </div> 
</div>
<br>
<h3>Search for a Recipe</h3>
<br>
<center>
<%= form_tag(recipes_path, :method => "get", id: "search-form") do %>
   <%= text_field_tag :search, params[:search], placeholder: "Search Recipes" %>
   <%= submit_tag "Search", :name => nil %>
<% end %>
<br>
</center>

<% if @recipes.blank?%>
  <h4 style='color: black;'>There are no recipes containing the term: "<%= params[:search] %>"</h4>
<% else unless params[:search].nil? %>
<div id="content">
    <% @recipes.each do |recipe| %>
    <div class="recipe">
        <div class="image">
            <%= if recipe.picture?
                    link_to image_tag(recipe.picture_url, size: "100x325"), recipe 
                else
                    pic_url_length = recipe.picture.to_s.length
                    beginning_index = recipe.picture.to_s.index('http')
                    if (beginning_index.nil?)
                        link_to image_tag('fallback/recipe-default.png', size: "100x350"), recipe
                    else
                        cut_url = recipe.picture.to_s[beginning_index, pic_url_length]
                        new_url = cut_url.gsub!('%3A', ":/")
                        link_to image_tag(new_url, size:"100x325"), recipe
                    end
                end
            %>
            <div class="name">
                <a href="/recipes/<%=recipe.id%>" style="color:white; padding-top: 5px; padding-bottom: 5px"><%= recipe.name %></a>
            </div>
        </div>
        <ul class="media">
	   		<li><i class="fa fa-clock-o"></i> ><%= recipe.prep_time %> Minutes</li>
		    <li><i class="fa fa-cutlery"></i> <%= recipe.servings %> People</li>
  		</ul>
    </div>
     <% end %>
  <% end %>
<% end %>
</div>
